# ğŸ“§ éƒµä»¶å‚™ä»½è¨­ç½®æŒ‡å—

## æ¦‚è¿°

ç³»çµ±æ”¯æ´æ¯æ—¥è‡ªå‹•å°‡ SQLite æ•¸æ“šåº«æ–‡ä»¶ä½œç‚ºé™„ä»¶ç™¼é€åˆ°æŒ‡å®šéƒµç®±ï¼Œæä¾›é¡å¤–çš„å‚™ä»½ä¿è­·ã€‚

## ğŸ› ï¸ è¨­ç½®æ­¥é©Ÿ

### 1. é…ç½® Gmail SMTPï¼ˆæ¨è–¦ï¼‰

#### å•Ÿç”¨ Gmail App Password
1. ç™»å…¥ Google å¸³æˆ¶
2. å‰å¾€ **Google å¸³æˆ¶è¨­ç½®** â†’ **å®‰å…¨æ€§**
3. å•Ÿç”¨ **å…©æ­¥é©Ÿé©—è­‰**ï¼ˆå¦‚æœæœªå•Ÿç”¨ï¼‰
4. åœ¨ **å…©æ­¥é©Ÿé©—è­‰** ä¸‹æ–¹ï¼Œé»æ“Š **æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼**
5. é¸æ“‡ **éƒµä»¶** å’Œ **å…¶ä»–ï¼ˆè‡ªè¨‚åç¨±ï¼‰**
6. è¼¸å…¥ "ç­ç´šç®¡ç†ç³»çµ±å‚™ä»½"
7. è¤‡è£½ç”Ÿæˆçš„ 16 ä½å¯†ç¢¼

#### é…ç½®ç’°å¢ƒè®Šé‡
åœ¨ `.env` æ–‡ä»¶ä¸­è¨­ç½®ï¼š

```bash
# Gmail SMTP é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-gmail@gmail.com
SMTP_PASS=your-16-digit-app-password

# éƒµä»¶è¨­ç½®
BACKUP_FROM_EMAIL=your-gmail@gmail.com
BACKUP_TO_EMAIL=backup-receiver@gmail.com
```

### 2. é…ç½®å…¶ä»–éƒµä»¶æœå‹™

#### Outlook/Hotmail
```bash
SMTP_HOST=smtp-mail.outlook.com
SMTP_PORT=587
SMTP_USER=your-email@outlook.com
SMTP_PASS=your-password
```

#### Yahoo Mail
```bash
SMTP_HOST=smtp.mail.yahoo.com
SMTP_PORT=587
SMTP_USER=your-email@yahoo.com
SMTP_PASS=your-app-password
```

#### è‡ªè¨‚ SMTP æœå‹™å™¨
```bash
SMTP_HOST=your-smtp-server.com
SMTP_PORT=587
SMTP_USER=your-username
SMTP_PASS=your-password
```

### 3. é€²éšéƒµä»¶è¨­ç½®

```bash
# å¤šå€‹æ”¶ä»¶äººï¼ˆå¯é¸ï¼‰
BACKUP_TO_EMAIL=primary@example.com,secondary@example.com

# æŠ„é€å’Œå¯†é€ï¼ˆå¯é¸ï¼‰
BACKUP_CC_EMAIL=manager@example.com
BACKUP_BCC_EMAIL=it-team@example.com

# è‡ªè¨‚ç™¼ä»¶äººé¡¯ç¤ºåç¨±ï¼ˆå¯é¸ï¼‰
BACKUP_FROM_EMAIL="ç­ç´šç®¡ç†ç³»çµ± <system@yourschool.edu>"
```

## ğŸ§ª æ¸¬è©¦é…ç½®

### 1. æª¢æŸ¥éƒµä»¶é…ç½®
```bash
npm run email:config
```

### 2. æ¸¬è©¦ SMTP é€£æ¥
```bash
npm run email:test
```

### 3. æ¸¬è©¦ç™¼é€å‚™ä»½æ–‡ä»¶
```bash
# å…ˆå‰µå»ºå‚™ä»½
npm run backup:local

# ç™¼é€æœ€æ–°å‚™ä»½
npm run email:send backups/classroom_backup_2024-01-01_12-00-00.db
```

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### ç«‹å³ç™¼é€å‚™ä»½éƒµä»¶
```bash
# å‰µå»ºå‚™ä»½ä¸¦ç™¼é€éƒµä»¶ï¼ˆä¸ä¸Šå‚³é›²ç«¯ï¼‰
npm run backup:email

# å®Œæ•´å‚™ä»½ï¼ˆæœ¬åœ° + é›²ç«¯ + éƒµä»¶ï¼‰
npm run backup
```

### è‡ªå‹•å®šæ™‚å‚™ä»½
è¨­ç½®æ¯æ—¥è‡ªå‹•å‚™ä»½ï¼ˆåŒ…å«éƒµä»¶ç™¼é€ï¼‰ï¼š
```bash
npm run setup:cron
```

æˆ–æ‰‹å‹•æ·»åŠ  crontabï¼š
```bash
crontab -e
# æ·»åŠ : 0 2 * * * cd /path/to/your/app && npm run backup
```

### ç™¼é€ç¾æœ‰å‚™ä»½æ–‡ä»¶
```bash
npm run email:send backups/your-backup-file.db
```

## ğŸ“§ éƒµä»¶å…§å®¹

è‡ªå‹•ç™¼é€çš„éƒµä»¶åŒ…å«ï¼š

- **ç¾è§€çš„ HTML æ ¼å¼**
- **å‚™ä»½è©³æƒ…**ï¼šæ–‡ä»¶åã€å¤§å°ã€å‚™ä»½æ™‚é–“
- **ç³»çµ±çµ±è¨ˆ**ï¼šå­¸ç”Ÿæ•¸é‡ã€è¨˜éŒ„ç¸½æ•¸ã€é‹è¡Œå¤©æ•¸
- **å®Œæ•´æ€§ç‹€æ…‹**ï¼šæ•¸æ“šåº«å®Œæ•´æ€§æª¢æŸ¥çµæœ
- **å®‰å…¨æé†’**ï¼šå‚™ä»½ä¿å­˜å’Œä½¿ç”¨å»ºè­°

## âš ï¸ æ³¨æ„äº‹é …

### å®‰å…¨å»ºè­°
1. **ä¸è¦åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼å¯†ç¢¼**
2. **ä½¿ç”¨ App Password è€Œéå¸³æˆ¶å¯†ç¢¼**
3. **å®šæœŸæ›´æ›éƒµä»¶å¯†ç¢¼**
4. **é™åˆ¶ .env æ–‡ä»¶æ¬Šé™**ï¼š
   ```bash
   chmod 600 .env
   ```

### æ–‡ä»¶å¤§å°é™åˆ¶
- **Gmail**: 25MB é™„ä»¶é™åˆ¶
- **Outlook**: 20MB é™„ä»¶é™åˆ¶
- **Yahoo**: 25MB é™„ä»¶é™åˆ¶

ä¸€èˆ¬ SQLite æ•¸æ“šåº«æ–‡ä»¶éƒ½å¾ˆå°ï¼ˆé€šå¸¸ < 1MBï¼‰ï¼Œä¸æœƒè§¸åŠé™åˆ¶ã€‚

### é˜²åƒåœ¾éƒµä»¶
1. **è¨­ç½®ç™½åå–®**ï¼šåœ¨æ”¶ä»¶éƒµç®±ä¸­å°‡ç™¼é€è€…åŠ å…¥ç™½åå–®
2. **æª¢æŸ¥åƒåœ¾éƒµä»¶å¤¾**ï¼šé¦–æ¬¡å¯èƒ½è¢«èª¤åˆ¤ç‚ºåƒåœ¾éƒµä»¶
3. **ä½¿ç”¨ä¼æ¥­éƒµç®±**ï¼šæ›´é«˜çš„é€é”ç‡

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹éŒ¯èª¤

**SMTP èªè­‰å¤±æ•—**
```
âŒ Invalid login: 535-5.7.8 Username and Password not accepted
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèª Gmail å·²å•Ÿç”¨å…©æ­¥é©Ÿé©—è­‰
- ä½¿ç”¨ App Password è€Œéå¸³æˆ¶å¯†ç¢¼
- æª¢æŸ¥ç”¨æˆ¶åæ ¼å¼ï¼ˆå®Œæ•´éƒµä»¶åœ°å€ï¼‰

**é€£æ¥è¶…æ™‚**
```
âŒ Connection timeout
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ç¶²è·¯é€£æ¥
- ç¢ºèª SMTP ä¸»æ©Ÿå’Œç«¯å£æ­£ç¢º
- æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®

**é™„ä»¶éå¤§**
```
âŒ å‚™ä»½æ–‡ä»¶éå¤§ï¼Œè¶…ééƒµä»¶é™„ä»¶é™åˆ¶
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥æ•¸æ“šåº«æ–‡ä»¶å¤§å°
- è€ƒæ…®æ•¸æ“šåº«æ¸…ç†æˆ–æ­¸æª”
- ä½¿ç”¨é›²ç«¯å‚™ä»½ä½œç‚ºæ›¿ä»£

### æª¢æŸ¥å‘½ä»¤

```bash
# æª¢æŸ¥é…ç½®
npm run email:config

# æŸ¥çœ‹è©³ç´°éŒ¯èª¤
NODE_ENV=development npm run email:test

# æª¢æŸ¥æ—¥èªŒ
tail -f logs/backup.log
```

## ğŸ“Š éƒµä»¶çµ±è¨ˆå’Œç›£æ§

ç³»çµ±æœƒè¨˜éŒ„ï¼š
- éƒµä»¶ç™¼é€æˆåŠŸ/å¤±æ•—æ¬¡æ•¸
- ç™¼é€æ™‚é–“å’Œæ”¶ä»¶äºº
- éŒ¯èª¤è©³æƒ…å’Œè§£æ±ºæ–¹æ¡ˆ

æŸ¥çœ‹æ—¥èªŒï¼š
```bash
# å‚™ä»½æ—¥èªŒ
tail -f logs/backup.log

# æ‡‰ç”¨æ—¥èªŒ
tail -f logs/app.log
```

## ğŸ”„ æœ€ä½³å¯¦è¸

1. **å®šæœŸæ¸¬è©¦**ï¼šæ¯æœˆæ¸¬è©¦ä¸€æ¬¡éƒµä»¶å‚™ä»½
2. **å¤šé‡å‚™ä»½**ï¼šçµåˆæœ¬åœ°ã€é›²ç«¯å’Œéƒµä»¶å‚™ä»½
3. **ç›£æ§éƒµä»¶**ï¼šç¢ºä¿æ¯æ—¥å‚™ä»½éƒµä»¶æ­£å¸¸æ”¶åˆ°
4. **æ–‡æª”å‚™ä»½**ï¼šä¿å­˜éƒµä»¶é…ç½®æ–‡æª”
5. **ç½é›£æ¢å¾©**ï¼šå®šæœŸæ¸¬è©¦å¾éƒµä»¶é™„ä»¶æ¢å¾©æ•¸æ“š

## ğŸ“ æ”¯æ´

å¦‚é‡å•é¡Œï¼š
1. æª¢æŸ¥ç’°å¢ƒè®Šé‡é…ç½®
2. é‹è¡Œè¨ºæ–·å‘½ä»¤
3. æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
4. åƒè€ƒæ•…éšœæ’é™¤æŒ‡å—

éƒµä»¶å‚™ä»½ç‚ºæ‚¨çš„é‡è¦æ•¸æ“šå¢åŠ äº†é¡å¤–ä¿è­·å±¤ï¼Œå»ºè­°èˆ‡å…¶ä»–å‚™ä»½æ–¹å¼çµåˆä½¿ç”¨ã€‚








